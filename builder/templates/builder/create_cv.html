{% extends 'builder/base.html' %} {% load static %} {% block title %}Create Your
CV{% endblock %} {% block content %}
<div class="container">
  <h1>Create Your CV</h1>

  <form method="POST" action="{% url 'builder:create_cv' %}" id="cv-form">
    {% csrf_token %}

    <div class="form-group">
      <label for="full_name">Full Name:</label>
      <input
        type="text"
        name="full_name"
        id="full_name"
        class="form-control"
        value="{{ user_data.full_name|default:'' }}"
        required
      />
    </div>

    <div class="form-group">
      <label for="email">Email Address:</label>
      <input
        type="email"
        name="email"
        id="email"
        class="form-control"
        value="{{ user_data.email|default:'' }}"
        required
      />
    </div>

    <div class="form-group">
      <label for="summary">Professional Summary:</label>
      <textarea
        name="summary"
        id="summary"
        class="form-control"
        rows="4"
        placeholder="Write a brief summary..."
      >
{{ user_data.summary|default:'' }}</textarea
      >
    </div>

    <div class="form-group">
      <label for="phone">Phone Number:</label>
      <input
        type="tel"
        name="phone"
        id="phone"
        class="form-control"
        value="{{ user_data.phone|default:'' }}"
        pattern="[0-9+\-\s()]*"
      />
    </div>

    <div class="form-group">
      <label for="location">Location:</label>
      <input
        type="text"
        name="location"
        id="location"
        class="form-control"
        value="{{ user_data.location|default:'' }}"
        placeholder="City, Country"
      />
    </div>

    <!-- Work Experience Section -->
    <div class="form-group">
      <h3>Work Experience</h3>
      <div id="experience-container">
        <!-- Dynamic entries go here -->
      </div>
      <button type="button" class="btn btn-secondary" onclick="addExperience()">
        Add Another Experience
      </button>
    </div>

    <!-- Education Section -->
    <div class="form-group">
      <h3>Education</h3>
      <div id="education-container">
        <!-- Dynamic entries go here -->
      </div>
      <button type="button" class="btn btn-secondary" onclick="addEducation()">
        Add Another Education
      </button>
    </div>

    <!-- Projects Section -->
    <div class="form-group">
      <h3>Projects</h3>
      <div id="projects-container">
        <!-- Dynamic entries go here -->
      </div>
      <button type="button" class="btn btn-secondary" onclick="addProject()">
        Add Another Project
      </button>
    </div>

    <div class="form-group">
      <label>Choose a Template:</label>
      <div class="row mt-3">
        {% for template in templates %}
        <div class="col-md-4">
          <div class="card template-card" data-template-id="{{ template.id }}">
            <img
              src="{{ template.preview_image.url }}"
              class="card-img-top"
              alt="{{ template.name }}"
            />
            <div class="card-body">
              <h5 class="card-title text-center">{{ template.name }}</h5>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="alert alert-warning">
            <strong>No templates available.</strong> Please check back later or
            contact support.
          </div>
        </div>
        {% endfor %}
      </div>
      <input type="hidden" name="template_id" id="template_id" required />
    </div>

    <button type="submit" class="btn btn-primary mt-3">Generate CV</button>
  </form>
</div>

<style>
  .template-card {
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s ease-in-out;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
  }
  .template-card.selected {
    border-color: #007bff;
  }
  /* Additional styles to match GlowUp CV */
  body {
    font-family: 'Arial', sans-serif;
    background-color: #f8f9fa;
  }
  h1,
  h3 {
    color: #333;
  }
  .btn-primary {
    background-color: #28a745;
    border-color: #28a745;
  }
  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Template selection
    const templateCards = document.querySelectorAll('.template-card');
    const hiddenTemplateInput = document.getElementById('template_id');

    templateCards.forEach((card) => {
      card.addEventListener('click', function () {
        // Remove 'selected' class from all cards
        templateCards.forEach((c) => c.classList.remove('selected'));
        // Add 'selected' class to the clicked card
        this.classList.add('selected');
        // Set the value of the hidden input
        hiddenTemplateInput.value = this.dataset.templateId;
      });
    });

    // Dynamic sections
    let experienceCount = 0;
    window.addExperience = function () {
      const container = document.getElementById('experience-container');
      const entry = document.createElement('div');
      entry.className = 'experience-entry mb-3 p-3 border rounded';
      entry.innerHTML = `
            <h5>Experience #${experienceCount + 1}</h5>
            <div class="row">
                <div class="col-md-6"><input type="text" name="experience[${experienceCount}][job_title]" class="form-control mb-2" placeholder="Job Title" required></div>
                <div class="col-md-6"><input type="text" name="experience[${experienceCount}][company]" class="form-control mb-2" placeholder="Company" required></div>
            </div>
            <textarea name="experience[${experienceCount}][description]" class="form-control" rows="3" placeholder="Description..." required></textarea>
            <button type="button" class="btn btn-danger btn-sm mt-2" onclick="this.parentElement.remove()">Remove</button>
        `;
      container.appendChild(entry);
      experienceCount++;
    };

    let educationCount = 0;
    window.addEducation = function () {
      const container = document.getElementById('education-container');
      const entry = document.createElement('div');
      entry.className = 'education-entry mb-3 p-3 border rounded';
      entry.innerHTML = `
            <h5>Education #${educationCount + 1}</h5>
            <div class="row">
                <div class="col-md-6"><input type="text" name="education[${educationCount}][degree]" class="form-control mb-2" placeholder="Degree" required></div>
                <div class="col-md-6"><input type="text" name="education[${educationCount}][school]" class="form-control mb-2" placeholder="School" required></div>
            </div>
            <input type="text" name="education[${educationCount}][year]" class="form-control" placeholder="Year" required>
            <button type="button" class="btn btn-danger btn-sm mt-2" onclick="this.parentElement.remove()">Remove</button>
        `;
      container.appendChild(entry);
      educationCount++;
    };

    let projectCount = 0;
    window.addProject = function () {
      const container = document.getElementById('projects-container');
      const entry = document.createElement('div');
      entry.className = 'project-entry mb-3 p-3 border rounded';
      entry.innerHTML = `
            <h5>Project #${projectCount + 1}</h5>
            <div class="row">
                <div class="col-md-6"><input type="text" name="projects[${projectCount}][name]" class="form-control mb-2" placeholder="Project Name" required></div>
                <div class="col-md-6"><input type="text" name="projects[${projectCount}][technologies]" class="form-control mb-2" placeholder="Technologies Used" required></div>
            </div>
            <textarea name="projects[${projectCount}][description]" class="form-control" rows="3" placeholder="Description..." required></textarea>
            <button type="button" class="btn btn-danger btn-sm mt-2" onclick="this.parentElement.remove()">Remove</button>
        `;
      container.appendChild(entry);
      projectCount++;
    };

    // Form validation
    document.getElementById('cv-form').addEventListener('submit', function (e) {
      const templateId = document.getElementById('template_id').value;
      if (!templateId) {
        e.preventDefault();
        alert('Please select a template before submitting.');
      }
    });
  });
</script>
{% endblock %}

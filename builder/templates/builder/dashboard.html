{% extends "builder/base.html" %} {% block content %}
<h2>Your Dashboard</h2>

<!-- Upload CV Button -->
<div class="mb-4">
  <a href="{% url 'upload_cv' %}" class="btn btn-success">Upload CV File</a>
  <a href="{% url 'builder:create_cv' %}" class="btn btn-primary"
    >Create New CV</a
  >
</div>

<!-- Created CVs Section -->
<h3>Your Created CVs</h3>
{% if cvs %}
<div class="cv-list">
  {% for cv in cvs %}
  <div class="cv-item">
    <h4><a href="{% url 'cv_detail' cv.pk %}">{{ cv.title }}</a></h4>
    <p>Created: {{ cv.created_at|date:"Y-m-d H:i" }}</p>
    <p>Sections: {{ cv.cvsection_set.count }}</p>
    <div class="cv-actions">
      <a href="{% url 'cv_detail' cv.pk %}" class="btn btn-sm btn-secondary"
        >View/Edit</a
      >
      <a href="{% url 'generate_cover_letter' %}" class="btn btn-sm btn-primary"
        >Generate Cover Letter</a
      >
      <form
        method="post"
        action="{% url 'delete_cv' cv.pk %}"
        style="display: inline"
        onsubmit="return confirm('Are you sure you want to delete this CV?');"
      >
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>
  No CVs created yet.
  <a href="{% url 'builder:create_cv' %}">Create your first CV</a>.
</p>
{% endif %}

<!-- Uploaded CVs Section -->
<h3 class="mt-5">Your Uploaded CVs</h3>
{% if uploaded_cvs %}
<div class="cv-list">
  {% for uploaded_cv in uploaded_cvs %}
  <div class="cv-item">
    <h4>{{ uploaded_cv.original_filename }}</h4>
    <p>Uploaded: {{ uploaded_cv.uploaded_at|date:"Y-m-d H:i" }}</p>
    {% if uploaded_cv.processed %}
    <span class="badge badge-success">Processed</span>
    {% else %}
    <span class="badge badge-warning">Processing...</span>
    {% endif %}
    <div class="cv-actions">
      <a
        href="{{ uploaded_cv.file.url }}"
        class="btn btn-sm btn-secondary"
        target="_blank"
        >View File</a
      >
      <form
        method="post"
        action="{% url 'delete_uploaded_cv' uploaded_cv.id %}"
        style="display: inline"
        onsubmit="return confirm('Are you sure you want to delete this uploaded CV?');"
      >
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>
  No CVs uploaded yet. <a href="{% url 'upload_cv' %}">Upload your first CV</a>.
</p>
{% endif %}

<!-- AI Cover Letters Section -->
{% if ai_cover_letters %}
<h3 class="mt-5">Recent AI Cover Letters</h3>
<div class="cv-list">
  {% for letter in ai_cover_letters %}
  <div class="cv-item">
    <h4>{{ letter.job_title }}</h4>
    <p>CV: {{ letter.uploaded_cv.original_filename }}</p>
    <p>Created: {{ letter.created_at|date:"Y-m-d H:i" }}</p>
    <div class="cv-actions">
      <a href="{% url 'ai_cover_letter' %}" class="btn btn-sm btn-secondary"
        >View Details</a
      >
    </div>
  </div>
  {% endfor %}
</div>
{% endif %} {% endblock %} {% block extra_css %}
<style>
  .cv-list {
    margin-top: 20px;
  }
  .cv-item {
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 5px;
  }
  .cv-item h3,
  .cv-item h4 {
    margin-top: 0;
  }
  .cv-item h3 a,
  .cv-item h4 a {
    text-decoration: none;
    color: #007bff;
  }
  .cv-actions {
    margin-top: 10px;
  }
  .btn {
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 4px;
    margin-right: 5px;
    border: none;
    cursor: pointer;
  }
  .btn-primary {
    background-color: #007bff;
    color: white;
  }
  .btn-secondary {
    background-color: #6c757d;
    color: white;
  }
  .btn-success {
    background-color: #28a745;
    color: white;
  }
  .btn-info {
    background-color: #17a2b8;
    color: white;
  }
  .btn-danger {
    background-color: #dc3545;
    color: white;
  }
  .btn-sm {
    padding: 5px 10px;
    font-size: 0.875rem;
  }
  .badge {
    padding: 3px 7px;
    font-size: 0.75rem;
    border-radius: 3px;
  }
  .badge-success {
    background-color: #28a745;
    color: white;
  }
  .badge-warning {
    background-color: #ffc107;
    color: black;
  }
  .mt-5 {
    margin-top: 3rem;
  }
  .mb-4 {
    margin-bottom: 1.5rem;
  }
</style>
{% endblock %}
